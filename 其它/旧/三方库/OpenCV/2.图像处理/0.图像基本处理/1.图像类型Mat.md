`cv::Mat`类表示单通道或多通道的多维数组，用于存储图像数据。但其结构自身并保存实际的图像数据，只存储头信息、指针和引用计数。

公共成员`data`保存图像数据的起始地址，相邻的两行数据在内存空间中可能并不一定连续，使用`isContinous()`成员函数可以判断数据是否全连续。所以`Mat`还拥有成员`step`，存储相邻行在内存空间中的距离。

---

#### 头信息

###### 像素类型

像素类型由深度和通道数组成。

1. 深度，像素单元的类型，使用`depth()`成员函数获取深度的枚举值。
2. 通道，像素点包含的存储单元数量，使用`channels()`成员函数获取通道数量。

OpenCV预定义一些像素类型的宏，其命名规范为`CV_[位数][类型]C[通道数]`，常用的有：

1. `CV_8UC1`，8位无符号单通道。
2. `CV_8UC3`，8位无符号三通道。
3. `CV_32FC3`，32位浮点三通道矩阵。

###### 尺寸

`Mat`对象的尺寸是以像素为单位进行计算的。使用`size()`或者通过公共成员`cols`和`rows`可以得到尺寸信息。

使用`reshape(channels, rows)`获取调整尺寸后的图像，需要保持`channels * rows * cols`不变。

使用`resize(height, color)`成员函数可以修改图像的高度。

1. `color`，可选参数，新增像素的颜色。

---

#### 创建

有多种方式可以创建`Mat`对象。

1. 构造函数，如`Mat(size, type)`。
2. 静态函数，如`Mat::zeros(size, type)`。

---

#### 拷贝

###### 深拷贝

使用`clone()`成员函数，创建完整副本。

使用`copyTo(dst, mask)`成员函数，将数据拷贝到其它矩阵。

1. `mask`，遮罩矩阵，只有和遮罩中非零元素对应的数据才会复制，其余位置用零填充。

---

#### 像素访问

有多种方式可以访问像素点。

1. 使用`at<T>(y, x)`成员函数访问像素点。
   1. `T`，像素的类型。
      1. 对于单通道图像，使用基本类型即可，如`CV_8UC1`使用`uchar`。
      2. 对于多通道图像，使用`cv::Vec_<>`，如`CV_8UC3`使用`cv::Vec3b`。
2. 使用`ptr(i)`成员函数获取`i`行数据的起始地址，然后通过指针访问像素点，效率更高。
3. 使用`begin<T>()`和`end<T>()`成员函数获取迭代器，再通过迭代器访问像素点。
4. 直接使用指针访问，其中第i行起始元素的计算公式为：$$ addr_i = img.data + img.step * i$$。

---

#### ROI

使用`()`操作符，可以获取`Mat`对象的ROI（Region Of Interest，感兴趣区域）。

1. `operator()(row_range, col_range)`，通过行、列范围获取ROI。
2. `operator()(rect)`，通过矩形区域获取ROI。

通过这种方式得到的图像和原图像共享相同的数据，只是保存不同的头信息。
