

[toc]

# 类型

lambda是[纯右值表达式]()，其类型是重载了`()`运算符的非聚合类类型，称为闭包类型。

如果lambda满足constexpr函数要求，其可用于常量表达式中。

```cpp
auto main() -> int {
    constexpr int ci = [] {
        if consteval { return 1; }
        return 0;
    }();
    std::cout << ci << "\n"; // 1

    int i = [] {
        if consteval { return 1; }
        return 0;
    }();
    std::cout << i << "\n"; // 0

    return 0;
}
```

# 捕获

捕获对象，实际上是在lambda类型中定义成员变量，即lambda的大小与其捕获的对象有关。

lambda重载的`()`运算符声明为`const`，所以默认情况下，通过值捕获的对象无法被修改。可以在参数列表后使用`mutable`声明，此时其成员变量也声明为`mutable`，可被修改。

```cpp
auto main() -> int {
    [i = 0]() mutable {
        i = 20;
    }();

    return 0;
}
```

## 捕获列表

捕获列表是由零个或多个由捕获符构成的逗号分隔列表，可以以默认捕获开始。

### 显示捕获

显示捕获有两种形式：

> * `[标识符]`，值捕获，对目标对象进行拷贝。
> * `[&标识符]`，引用捕获，得到目标对象的引用。

c++14起，可使用`[标识符=初始值]`、`[&标识符=初始值]`进行初始化捕获，其类型推断等价`auto`。

### 默认捕获

默认捕获有两种形式：

> * `[=]`，使用值捕获捕获被使用的自动存储器对象。
> * `[&]`，使用引用捕获捕获被使用的自动存储器对象。


